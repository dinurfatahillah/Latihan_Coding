#include <iostream>
#include <fstream>
#include <string>

void printData(const std::string fileName){
    bool isiFile;

    std::ifstream file (fileName);
    if(!file.is_open()){
        std::cout << "File Tidak Dapat Dibuka\n";
        return;
    }

    std::string line;
    std::cout << std::endl;
    while(std::getline(file, line)){
        isiFile = true;
        std::cout << line << std::endl;
    }
    if(!isiFile){
        std::cout    << "File Ini Kosong !\n";
    }
    file.close();
}

void tambahDataPegawai(const std::string fileName){
    std::string nama;
    std::string gaji;

    std::ofstream file(fileName, std::ios::app);
    if(!file.is_open()){
        std::cout << "File Gagal Dibuat\n";
        return;
    }

    std::cout << "Nama Pegawai : ";
    std::getline(std::cin, nama);
    std::cout << "Gaji Pegawai : ";
    std::getline(std::cin, gaji);

    file << "Nama : " << nama << "\n" << "Gaji : Rp " << gaji << "\n\n";

    file.close();
}

void cariDataPegawai(const std::string fileName){
    std::string cariNama;

    std::ifstream file(fileName);
    if(!file.is_open()){
        std::cout << "File Gagal Dibuka\n";
        return;
    }

    std::string line;
    bool ditemukan = false;

    std::cout << "Cari Nama Pegawai : ";
    std::getline(std::cin, cariNama);
    std::cout << std::endl;
    while(std::getline(file, line)){
        if(line.find(cariNama) != std::string::npos){
            ditemukan = true;
            std::cout << "Nama Ditemukan \n\n";
            std::cout << line << std::endl;
            std::string line2;
            std::getline(file,line2);
            std::cout << line2 << std::endl;
            std::cout << std::endl;
        }
    }
    if(!ditemukan){
        std::cout << "Nama Tidak Ditemukan \n";
        return;
    }
}

void editDataPegawai(const std::string fileName, const std::string fileTemp){
    std::string cariNama;
    std::string newName;
    std::string newGaji;
    
    std::ifstream file(fileName);
    if (!file.is_open()){
        std::cout << "Fili Gagal Dibuka\n";
        return;
    }

    std::ofstream file2(fileTemp);
    if(!file2.is_open()){
        std::cout << "File Temp Gagal Dibuat\n";
        return;
    }
    
    std::string line;
    while(std::getline(file,line)){
        file2 << line << std::endl;
    }

    file.close();
    file2.close();
    int hasil = std::remove(fileName.c_str());
    if(hasil == 0){
        std::ofstream fileBaru(fileName);
        if(!fileBaru.is_open()){
            std::cout << "File Baru Gagal Dibuat\n";
            return;
        }
    }else{
        std::cout << "Gagal Menghapus File\n";
        return;
    }

    std::ofstream file3(fileName);
    if(!file3.is_open()){
        std::cout << "File 3 Gagal Dibuat\n";
        return;
    }
    std::ifstream file4("temp.txt");
    if(!file4.is_open()){
        std::cout << "File 4 Gagal Dibuka\n";
        return;
    }

    std::cout << "Masukan Nama Pegawai Yang Akan Di Edit : ";
    std::getline(std::cin , cariNama);
    
    bool ditemukan = false;
    while(std::getline(file4,line)){
        if(line.find(cariNama) != std::string::npos){

            ditemukan = true;

            std::cout << "Nama Pegawai Ditemukan\n";
            std::cout << line << std::endl;
            std::string line2;
            std::getline(file4,line2);
            std::cout << line2 << std::endl;
            std::cout << "\n===========================\n";
            
            std::cout << "Edit Nama Pegawai : ";
            std::getline(std::cin, newName);
            std::cout << "Edit Gaji Pegawai : ";
            std::getline(std::cin, newGaji);

            file3 << "Nama : " << newName << "\n" << "Gaji : " << newGaji << std::endl;
        }else{
            file3 << line << std::endl;
        }std::cout << std::endl;

    }
    if(!ditemukan){
        std::cout << "Nama Pegawai Tidak Ditemukan\n";
        return;
    }

    file3.close();
    file4.close();

}

int main(){
    int pilih;
    const std::string fileName = "dataPegawai.txt";
    const std::string fileTemp = "temp.txt";

    std::cout << "======================================\n";
    std::cout << "SELAMAT DATANG DI APLIKAI DATA PEGAWAI\n";
    std::cout << "======================================\n";
    std::cout << std::endl;

    do{
        
        std::cout << "1] Tampilkan Data Pegawai\n";
        std::cout << "2] Tambah Data Pegawai\n";
        std::cout << "3] Cari Data Pegawai Berdasarkan Nama\n";
        std::cout << "4] Edit Data Pegawai\n";
        std::cout << "5] Hapus  Data Pegawai\n";
        std::cout << "6] Opsi Lainnya\n";
        std::cout << std::endl;
        std::cout << "Pilih Nomor : ";
        std::cin >> pilih;
        std::cin.ignore();

        if(pilih == 1){
            printData(fileName);
        }else if(pilih == 2){
            tambahDataPegawai(fileName);
        }else if(pilih == 3){
            cariDataPegawai(fileName);
        }else if(pilih == 4){
            editDataPegawai(fileName,fileTemp);
        }else{
            return 0;
        }
    
    }while(true);
    
}
